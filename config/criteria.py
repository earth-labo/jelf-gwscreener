"""
診断基準データの管理
"""

# 診断基準のバージョン定義
VERSIONS = {
    "v1": {
        "name": "Version 1: 完全版",
        "description": "すべての診断基準を適用。包括的な監査、法務レビューに最適。",
        "sections": {
            "empowerment_only": ["1.1", "1.2", "1.3", "1.4", "1.5", "1.6", "1.7", "1.8", "1.9", "1.10", "1.11", "1.12", "1.13", "3.1", "3.2", "3.3", "3.4", "3.5", "4.1", "4.2", "4.3", "4.4"],
            "both_directives": ["1.1", "1.2", "1.3", "1.4", "1.5", "1.6", "1.7", "1.8", "1.9", "1.10", "1.11", "1.12", "1.13", "2.1", "2.2", "2.3", "2.4", "2.5", "3.1", "3.2", "3.3", "3.4", "3.5", "4.1", "4.2", "4.3", "4.4"]
        }
    },
    "v2": {
        "name": "Version 2: 重要項目版",
        "description": "重要度の高い項目に絞った診断。マーケティング自己チェック、迅速スクリーニングに最適。",
        "sections": {
            "empowerment_only": ["1.1", "1.2", "1.3", "1.4", "1.5", "3.1", "4.2", "4.4"],
            "both_directives": ["1.1", "1.2", "1.3", "1.4", "1.5", "2.1", "2.2", "2.4", "3.1", "4.2", "4.4"]
        }
    },
    "v3": {
        "name": "Version 3: Climate特化版",
        "description": "気候関連のみに集中。カーボンニュートラル主張、気候コミュニケーションのレビューに最適。",
        "sections": {
            "empowerment_only": ["1.1", "1.2", "1.3", "1.4", "3.1", "3.2", "3.3", "3.4", "3.5", "4.1", "4.2", "4.3", "4.4"],
            "both_directives": ["1.1", "1.2", "1.3", "1.4", "2.1", "2.2", "2.3", "2.4", "2.5", "3.1", "3.2", "3.3", "3.4", "3.5", "4.1", "4.2", "4.3", "4.4"]
        }
    }
}

# リスクレベルの定義
RISK_LEVELS = {
    "High Risk": {
        "score_range": (0, 15),
        "color": "🔴",
        "description": "重大なClimateWash。即座の是正が必要。法的リスクが極めて高い。"
    },
    "Medium Risk": {
        "score_range": (16, 50),
        "color": "🟠",
        "description": "中程度のClimateWash。早期の是正を推奨。レピュテーションリスクあり。"
    },
    "Low Risk": {
        "score_range": (51, 85),
        "color": "🟡",
        "description": "軽微な問題。情報追加により是正可能。"
    },
    "Compliant": {
        "score_range": (86, 100),
        "color": "🟢",
        "description": "適切。法的リスクは低い。"
    }
}

def get_risk_level(score: int) -> str:
    """スコアからリスクレベルを判定"""
    for level, info in RISK_LEVELS.items():
        min_score, max_score = info["score_range"]
        if min_score <= score <= max_score:
            return level
    return "Unknown"

def get_criteria_sections(version: str, include_green_claims: bool) -> list:
    """選択されたバージョンと指令に基づいて適用する診断基準セクションを取得"""
    if version not in VERSIONS:
        return []
    
    directive_key = "both_directives" if include_green_claims else "empowerment_only"
    return VERSIONS[version]["sections"][directive_key]

# 例文ライブラリ
EXAMPLE_LIBRARY = {
    "気候中立関連": [
        {
            "ng": "カーボンニュートラル",
            "ok": "製造工程のCO2排出量を2020年比30%削減（Scope 1, 2）。検証機関: [機関名]、検証レポート: [URL]",
            "reason": "一般的・抽象的な主張は禁止。具体的な削減量と検証情報が必要。"
        },
        {
            "ng": "カーボンオフセットにより気候中立",
            "ok": "自社排出削減: 2020年比40%削減（100t→60t）。残余排出40tについてオフセット使用（植林プロジェクト、追加性検証済み）。",
            "reason": "オフセットのみに依存した主張は禁止。自社削減とオフセットを明確に区別する必要がある。"
        },
        {
            "ng": "CO2ゼロ",
            "ok": "本製品のライフサイクル全体のCO2排出量45kg（LCA実施、ISO 14040/44準拠、検証機関: [機関名]）",
            "reason": "「ゼロ」は実証が困難。具体的な排出量とLCA実施情報を明記。"
        }
    ],
    "削減目標": [
        {
            "ng": "2030年までにカーボンニュートラルを目指します",
            "ok": "2030年CO2排出量50%削減目標（2020年比、Scope 1-3）。実施計画: [URL]、進捗報告: 四半期ごと、第三者検証: [機関名]",
            "reason": "未来目標には、具体的な公開コミットメント、実施計画、第三者検証、進捗報告が必須。"
        },
        {
            "ng": "削減に取り組んでいます",
            "ok": "2023年実績: CO2排出量を前年比15%削減（120t→102t、Scope 1, 2）",
            "reason": "曖昧な表現ではなく、具体的な数値と期間を明記。"
        }
    ],
    "再生可能エネルギー": [
        {
            "ng": "再生可能エネルギーを使用",
            "ok": "本社ビル使用電力の65%を太陽光発電で賄う（2023年実績、総使用量100MWh中65MWh）",
            "reason": "全体のうち何%か、どこで使用しているのかを明示。"
        },
        {
            "ng": "クリーンエネルギー100%",
            "ok": "国内全工場の使用電力を再生可能エネルギー由来に切替（2024年4月〜、グリーン電力証書購入）",
            "reason": "範囲と方法を具体的に明記。"
        }
    ],
    "リサイクル素材": [
        {
            "ng": "リサイクル素材使用",
            "ok": "パッケージの30%に再生プラスチックを使用（重量比、食品グレード再生材、認証: [認証名]）",
            "reason": "製品のどの部分に、何%使用しているかを明記。"
        },
        {
            "ng": "環境に優しいパッケージ",
            "ok": "パッケージをFSC認証紙100%に変更（2024年1月〜、認証番号: [番号]）。従来比でCO2排出量20%削減。",
            "reason": "具体的な認証と環境性能を明記。"
        }
    ],
    "製品の環境性能": [
        {
            "ng": "エコフレンドリー",
            "ok": "エコマーク認証取得（認定番号: [番号]）。同カテゴリー製品平均比でライフサイクルCO2排出量25%削減。",
            "reason": "第三者認証と具体的な性能比較を明記。"
        },
        {
            "ng": "地球に優しい",
            "ok": "LCA実施結果: 製品ライフサイクル全体の環境影響を定量化（ISO 14040/44準拠、第三者検証済み）。詳細: [URL]",
            "reason": "科学的根拠と検証情報を提供。"
        }
    ]
}
